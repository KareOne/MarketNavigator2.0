# Crunchbase API Remote Worker Deployment
# Deploy this alongside the Crunchbase API to connect to the main orchestrator

services:
  # ==========================================================================
  # Crunchbase API Scraper
  # ==========================================================================
  crunchbase_api:
    build: .
    container_name: remote-crunchbase-api
    command: sh -c "python api_handler.py"
    volumes:
      - .:/app
    environment:
      PYTHONWARNINGS: "ignore::FutureWarning"
      PANDAS_FUTURE_NO_SILENT_DOWNCASTING: "True"
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8003/health" ]
      interval: 30s
      timeout: 10s
      retries: 3

  # ==========================================================================
  # Worker Agent (connects to main server orchestrator)
  # ==========================================================================
  worker_agent:
    build:
      context: ./worker_agent
      dockerfile: Dockerfile
    container_name: remote-crunchbase-worker
    command: python -m agent
    environment:
      - ORCHESTRATOR_URL=${ORCHESTRATOR_URL:-ws://89.42.199.54:8010/ws/worker}
      - WORKER_TOKEN=${WORKER_TOKEN}
      - API_TYPE=crunchbase
      - WORKER_NAME=${WORKER_NAME:-crunchbase-remote-1}
      - LOCAL_API_URL=http://crunchbase_api:8003
      - HEARTBEAT_INTERVAL=10
      - RECONNECT_DELAY=5
      - LOG_LEVEL=INFO
    depends_on:
      crunchbase_api:
        condition: service_healthy
    restart: unless-stopped

networks:
  default:
    name: crunchbase-remote-network
